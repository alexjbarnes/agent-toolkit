# Orchestrator workflow. Runs all checks on push/PR to main.
# All jobs are reusable workflows defined in separate files.

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  secrets:
    uses: ./.github/workflows/secrets.yml

  socket:
    uses: ./.github/workflows/socket.yml
    secrets: inherit

  lint:
    uses: ./.github/workflows/lint.yml

  test:
    uses: ./.github/workflows/test.yml
    with:
      # Only update the coverage badge on pushes to main, not on PRs.
      update-badge: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
    secrets: inherit

  cross-compile:
    uses: ./.github/workflows/cross-compile.yml
